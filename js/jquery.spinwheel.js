(function(a){a.fn.spinwheel=function(b,c,d){function x(a,b,c,d){var e=(a/=d)*a;var f=e*a;return b+c*(f+ -3*e+3*a)}function w(){g.strokeStyle=e.wheelBorderColor;g.lineWidth=e.wheelBorderWidth;g.font=e.wheelTextFont;g.clearRect(0,0,500,500);var a=null,b=0,c=p;for(b=0;b<c;b++){a=q[b];var d=i+b*j;g.fillStyle=h.length>c?h[b]:s();g.beginPath();g.arc(250,250,e.outterRadius,d,d+j,false);g.arc(250,250,e.innerRadius,d+j,d,true);g.stroke();g.fill();g.save();g.shadowOffsetX=-1;g.shadowOffsetY=-1;g.shadowBlur=1;g.shadowColor=e.wheelTextShadowColor;g.fillStyle=e.wheelTextColor;g.translate(250+Math.cos(d+j/2)*e.textRadius,250+Math.sin(d+j/2)*e.textRadius);g.rotate(d+j/2+Math.PI/2);g.fillText(a,-g.measureText(a).width/2,0);g.restore();g.closePath()}v()}function v(){g.fillStyle=e.arrowColor;g.beginPath();g.moveTo(250-4,250-(e.outterRadius+15));g.lineTo(250+4,250-(e.outterRadius+15));g.lineTo(250+4,250-(e.outterRadius-15));g.lineTo(250+9,250-(e.outterRadius-15));g.lineTo(250+0,250-(e.outterRadius-23));g.lineTo(250-9,250-(e.outterRadius-15));g.lineTo(250-4,250-(e.outterRadius-15));g.lineTo(250-4,250-(e.outterRadius+15));g.fill()}function u(){clearTimeout(k);var b=i*180/Math.PI+90;var d=j*180/Math.PI;var f=Math.floor((360-b%360)/d);g.save();g.font=e.resultTextFont;var h=q[f];var l=getGame(c,h);a(e.winnerDiv).html(l).show();g.fillText(h,250-g.measureText(h).width/2,250+10);g.restore()}function s(){var b=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],c="",d=[],e;for(e=0;e<6;e++){d[e]=b[Math.round(Math.random()*14)];c=c+d[e]}if(a.inArray(c,h)>-1){s()}else{h.push("#"+c);return"#"+c}}var e=a.extend({},a.fn.spinwheel.default_options,b),f=a(this),g=null,h=[],i=0,j=2*Math.PI/e.pplArray.length,k=null,l=10,m=0,n=0,o=0,p=e.pplArray.length,q=e.pplArray,c=e.gameName;if(a.isFunction(b)){d=b;b={}}var r={init:function(){r.getContext();r.setup();w()},setup:function(){a(e.spinTrigger).bind("click",function(b){a(this).fadeOut("slow");b.preventDefault();r.spin()});a(e.addPplTrigger).bind("click",function(b){b.preventDefault();var c=a("<li />").append(a(e.joiner).val());a(e.paricipants).append(c);r.updatePanel()})},getContext:function(){if(g!==null)return g;var a=f[0];g=a.getContext("2d")},spin:function(){o=Math.random()*10+10;m=0;n=Math.random()*3+4*1e3;t()},updatePanel:function(){var b=a(e.paricipants).children();q=[];b.each(function(a,b){q.push(b.innerHTML)});j=2*Math.PI/b.length;p=b.length;w()}};var t=function y(){m+=30;if(m>=n){u();return}var a=o-x(m,0,o,n);i+=a*Math.PI/180;w();k=setTimeout(y,30)};r.init.apply(this,[])};a.fn.spinwheel.default_options={outterRadius:200,innerRadius:3,textRadius:160,spinTrigger:".spin-trigger",wheelBorderColor:"black",wheelBorderWidth:3,wheelTextFont:"bold 15px sans-serif",wheelTextColor:"black",wheelTextShadowColor:"rgb(100,100,100)",resultTextFont:"bold 30px sans-serif",arrowColor:"white",paricipants:".participants",addPplTrigger:".add",joiner:".joiner",winnerDiv:".winner"}})(jQuery)